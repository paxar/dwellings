/*!  1.1.2 2017-04-03 17:39 */
!function(a,b){var c=function(a){this.element=a,this.map=new google.maps.Map(a,{mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0}),this.mapmarkers=[],this.bounds=new google.maps.LatLngBounds,d.dataDefined(this,"search")&&d.setupSearch(this);var b=d.getMapCenter(this);return this.map.setCenter(b),this.bounds.extend(b),d.dataDefined(this,"markers")&&d.setupMarkers(this),this.map.fitBounds(this.bounds),d.setupZoom(this),this.mapmarkers.length&&(markerCluster=new MarkerClusterer(this.map,this.mapmarkers,JSON.parse(CHARITABLE_GEOLOCATION.markerclusterer_options))),d.setupInitialMapLocation(this),this},d={};d.setupMarkers=function(a){for(var b=new google.maps.InfoWindow,c=JSON.parse(a.element.dataset.markers),e=0;e<c.length;e++){var f=new google.maps.Marker({position:new google.maps.LatLng(c[e].latitude,c[e].longitude),map:a.map});a.bounds.extend(f.position),google.maps.event.addListener(f,"click",function(e,f){return function(){b.setContent(d.getMarkerContent(c[f])),b.open(a.map,e)}}(f,e)),a.mapmarkers.push(f)}},d.setupSearch=function(a){a.search=b.getElementById(a.element.dataset.search),null!==a.search&&(a.autocomplete=new google.maps.places.Autocomplete(a.search),a.a_infowindow=new google.maps.InfoWindow,a.a_marker=new google.maps.Marker({map:a.map,anchorPoint:new google.maps.Point(0,-29)}),a.autocomplete.bindTo("bounds",a.map),a.autocomplete.addListener("place_changed",function(){return d.setupPlace(a,a.autocomplete.getPlace())}))},d.setupPlace=function(a,b){if(a.a_infowindow.close(),a.a_marker.setVisible(!1),!b.geometry)return service=new google.maps.places.PlacesService(a.map),void service.textSearch({query:b.name},function(b,c){if(c===google.maps.places.PlacesServiceStatus.OK)for(var e=0;e<b.length;e++)d.setupPlace(a,b[e])});b.geometry.viewport?a.map.fitBounds(b.geometry.viewport):(a.map.setCenter(b.geometry.location),a.map.setZoom(17)),d.storePlaceDetails(b,a),a.a_marker.setIcon({url:b.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),a.a_marker.setPosition(b.geometry.location),a.a_marker.setVisible(!0);var c="";b.address_components&&(c=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" ")),a.a_infowindow.setContent("<div><strong>"+b.name+"</strong><br>"+c),a.a_infowindow.open(a.map,a.a_marker)},d.setupZoom=function(a){var b=function(){var b=d.dataDefined(a,"zoom")?a.element.dataset.zoom:CHARITABLE_GEOLOCATION.default_zoom;return parseInt(b,10)}(),c=google.maps.event.addListener(a.map,"idle",function(){a.map.setZoom(b),google.maps.event.removeListener(c)})},d.getMarkerContent=function(a){var b=CHARITABLE_GEOLOCATION.marker;return b=null===a.thumbnail?b.replace(/<img src="{thumbnail}" alt="{title}" \/>/g,""):b.replace(/{thumbnail}/g,a.thumbnail),b=b.replace(/{title}/g,a.title),b=b.replace(/{link}/g,a.link),b=b.replace(/{description}/g,a.description)},d.dataDefined=function(a,b){return"undefined"!=typeof a.element.dataset[b]},d.getMapCenter=function(b){var c,e;return d.dataDefined(b,"lat")&&b.element.dataset.lat.length&&(c=b.element.dataset.lat),d.dataDefined(b,"long")&&b.element.dataset.long.length&&(e=b.element.dataset.long),"undefined"!=typeof c&&"undefined"!=typeof e||(navigator.geolocation&&"https"===a.location.protocol&&navigator.geolocation.getCurrentPosition(function(a){c=a.coords.latitude,e=a.coords.longitude}),"undefined"==typeof c&&(c=parseFloat(CHARITABLE_GEOLOCATION.default_lat),e=parseFloat(CHARITABLE_GEOLOCATION.default_long))),new google.maps.LatLng(c,e)},d.setupInitialMapLocation=function(a){var c=b.querySelector('a[href="#campaign-location'),e=function(){if(d.dataDefined(a,"placeid")&&a.element.dataset.placeid.length){var b=new google.maps.places.PlacesService(a.map);b.getDetails({placeId:a.element.dataset.placeid},function(b,c){c===google.maps.places.PlacesServiceStatus.OK&&d.setupPlace(a,b)})}else a.map.setCenter(d.getMapCenter(a))};null!==c?c.addEventListener("click",function(){e(a),google.maps.event.trigger(a.map,"resize")}):e(a)},d.storePlaceDetails=function(a,c){if("undefined"==typeof c.longitude){var d=b.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","_campaign_longitude"),c.search.parentNode.appendChild(d),c.longitude=b.querySelector("[name=_campaign_longitude]")}if("undefined"==typeof c.latitude){var e=b.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","_campaign_latitude"),c.search.parentNode.appendChild(e,c.search),c.latitude=b.querySelector("[name=_campaign_latitude]")}if("undefined"==typeof c.place_id){var f=b.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","_gmaps_place_id"),c.search.parentNode.appendChild(f,c.search),c.place_id=b.querySelector("[name=_gmaps_place_id]")}c.longitude.setAttribute("value",a.geometry.location.lng()),c.latitude.setAttribute("value",a.geometry.location.lat()),c.place_id.setAttribute("value",a.place_id)};var e=function(){CHARITABLE_GEOLOCATION.maps=[],maps=b.getElementsByClassName("charitable-map");for(var a=0;a<maps.length;a++)CHARITABLE_GEOLOCATION.maps[a]=new c(maps[a])};a.onload=e}(window,document);