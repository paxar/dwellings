!function(a){var b,c,d=function(c,d){d.error?alert(d.error.message):(b.find("[name=stripe_token]").val(d.id),a("body").off("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",f),b.attr("data-use-ajax",1).trigger("submit"),a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",f))},e=function(a){"stripe"===new CHARITABLE.Donation_Form(a).get_payment_method()&&a.attr("data-use-ajax",0)},f=function(b){return b.stopImmediatePropagation(),e(a(this)),a("body").off("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",f),a(this).trigger("submit"),a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",f),!1};a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",f),a("body").on("submit","#charitable-donation-form[data-use-ajax=0]",function(e){b=a(this),c=new CHARITABLE.Donation_Form(b);var f=c.get_cc_number(),g=c.get_cc_cvc(),h=c.get_cc_expiry_month(),i=c.get_cc_expiry_year();return c.clear_cc_fields(),"stripe"!==c.get_payment_method()||(e.preventDefault(),c.validate()?Stripe.card.validateCardNumber(f)?Stripe.card.validateExpiry(h,i)?(Stripe.card.createToken({number:f,cvc:g,exp_month:h,exp_year:i},d),!1):(alert(CHARITABLE_VARS.error_invalid_cc_expiry),!1):(alert(CHARITABLE_VARS.error_invalid_cc_number),!1):(alert(c.get_error_message()),!1))}),a("body").on("change","#charitable-gateway-selector input[name=gateway]",function(){e(a(this).parents("#charitable-donation-form"))}),a(document).ready(function(){Stripe.setPublishableKey(CHARITABLE_STRIPE_VARS.key);var b=a("#charitable-donation-form");b.length&&e(b),a("#charitable-gateway-selector input[name=gateway]").trigger("change")})}(jQuery);